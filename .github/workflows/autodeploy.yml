name: è‡ªåŠ¨éƒ¨ç½²

# å½“æœ‰æ”¹åŠ¨æ¨é€å’Œè¯­é›€å‘å¸ƒæ—¶ï¼Œå¯åŠ¨Action
on: [push, repository_dispatch]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: æ£€æŸ¥åˆ†æ”¯
        uses: actions/checkout@v2
        with:
          ref: master

      #2020å¹´10æœˆågithubæ–°å»ºä»“åº“é»˜è®¤åˆ†æ”¯æ”¹ä¸ºmainï¼Œæ³¨æ„æ›´æ”¹
      #ä½†ç§æœ‰ä»“åº“è²Œä¼¼è¿˜æ˜¯masterå¹¶æ²¡æœ‰å˜

      - name: å®‰è£… Node
        uses: actions/setup-node@v1
        with:
          node-version: "12.x"

      - name: å®‰è£… Hexo
        run: |
          export TZ='Asia/Shanghai'
          npm install hexo-cli -g
          npm install gulp-cli -g
          #å¦‚æœä½ æœ‰ä½¿ç”¨gulpçš„è¯ï¼Œæ‰“å¼€ä¸Šé¢è¿™ä¸€è¡Œ
          npm install yuque-hexo -g
          yuque-hexo clean
          yuque-hexo sync
          npm i --save
          npm install highlight.js --save

      - name: ç¼“å­˜ Hexo
        uses: actions/cache@v1
        id: cache
        with:
          path: node_modules
          key: ${{runner.OS}}-${{hashFiles('**/package-lock.json')}}

      - name: å®‰è£…ä¾èµ–
        if: steps.cache.outputs.cache-hit != 'true'
        run: |
          npm install --save
          npm install highlight.js --save

      - name: ç”Ÿæˆé™æ€æ–‡ä»¶
        run: |
          hexo clean
          hexo g
          gulp

      - name: éƒ¨ç½²
        run: |
          git config --global user.name "slblog-github"
          git config --global user.email "sladmin@slwebtap.onmicrosoft.com"
          git add public/
          git commit -m "ğŸ‡ Update from GitHub Actions Auto RobotğŸ‡"
          hexo deploy